# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Gladys is a personal AI assistant built on [OpenClaw](https://openclaw.dev), accessed via Telegram (text + voice), with Claude Opus 4.6 as the primary reasoning model. It runs on a bare metal Hetzner VPS (no Docker) at `gladys.simonschenker.com`.

## Key Architectural Concept

This repo (`~/gladys`) contains project files at the root. OpenClaw state lives in the `openclaw/` subfolder (`OPENCLAW_STATE_DIR=~/gladys/openclaw`), keeping a clear separation between project files (scripts, docs, config) and OpenClaw-generated files (agents, sessions, credentials). Secrets live in `.env` (gitignored, at repo root), and `openclaw/openclaw.json` uses `${ENV_VAR}` substitution — no secrets in config files.

## Architecture

```
Telegram (text/voice)
        |
        v
 OpenClaw Gateway (port 18789, loopback only, token auth)
        |
        |-- Channel layer: Telegram adapter
        |     \-- Whisper STT (voice -> text)
        |
        |-- Agent: Claude Opus 4.6 (all reasoning)
        |     |-- Notion skill (tasks, projects, state)
        |     \-- Google Docs skill (logs, drafts, artifacts)
        |
        \-- Memory subsystem
              |-- MEMORY.md (durable facts)
              |-- memory/YYYY-MM-DD.md (daily context)
              \-- SQLite vector index (semantic search)
```

Model separation: Claude handles all reasoning, Whisper handles STT only. Notion holds structured state (tasks, projects), Google Docs holds narrative artifacts (logs, notes, drafts). OpenClaw's built-in memory handles agent recall.

## OpenClaw Commands

```bash
openclaw onboard          # Interactive config wizard (generates openclaw.json)
openclaw doctor           # Health check
openclaw gateway start    # Launch gateway server
openclaw models status    # Verify active models
openclaw security audit   # Verify security settings
```

The gateway runs as a systemd user service (`openclaw-gateway.service`). Manage with:
```bash
systemctl --user start openclaw-gateway
systemctl --user status openclaw-gateway
systemctl --user restart openclaw-gateway
```

## VPS Deployment

`scripts/setup.sh` is an idempotent bootstrap script (safe to re-run) that provisions the VPS: creates user, hardens SSH, configures UFW, installs Node.js 22.x + OpenClaw + Claude Code, clones the repo, sets up systemd service. See README.md for the full setup workflow.

## Development Phases

The project follows a phased rollout defined in `roadmap.md`:

| Phase | Goal | Status |
|-------|------|--------|
| 0 | VPS provisioned & secured | Done |
| 1 | OpenClaw + Telegram text chat with Claude | Current |
| 2 | Whisper STT for voice messages | Planned |
| 3 | Notion + Google Docs integrations | Planned |
| 4 | Combined voice → transcription → tasks + docs | Planned |

## Design Principles

1. **No silent side effects** — every agent action is reported back to the user.
2. **Clear separation** — models by capability, state vs. memory, local vs. deployed.
3. **Each phase is independently testable** with explicit validation criteria.
4. **Context survives across days.**

## Security Model

- Gateway binds to loopback only with token auth, mDNS disabled
- SSH key-only auth, root login disabled, UFW rate-limits port 22
- Systemd hardening: NoNewPrivileges, PrivateTmp, ProtectSystem=strict
- `openclaw/` dir permissions 700, `.env` permissions 600

## Key Files

- `roadmap.md` — authoritative source for phases, decisions, architecture, and validation criteria
- `.roadmap/` — phase-specific planning docs (e.g., email integration guide)
- `scripts/setup.sh` — VPS bootstrap script (idempotent)
- `.env.example` — required API keys template
- `openclaw/` — OpenClaw state dir (`OPENCLAW_STATE_DIR`), generated by `openclaw onboard`
- `openclaw/openclaw.json` — OpenClaw config, generated by wizard, not hand-crafted
